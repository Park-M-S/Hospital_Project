# í˜„ì¬ ë¬¸ì œ ìˆëŠ” í”„ë¡ íŠ¸ì—”ë“œ ì •ë¦¬
docker stop hospital-frontend
docker rm hospital-frontend

# ê²€ì¦ ë‹¨ê³„ë¥¼ ê±´ë„ˆë›°ê³  ì§ì ‘ Caddy ì‹¤í–‰
docker run -d \
  --name hospital-frontend \
  --network ec2-user_hospital-network \
  -p 80:80 -p 443:443 \
  caddy:2-alpine \
  sh -c '
echo "
{
    email mmmg0306@g.shingu.ac.kr
}

http://hospitalmap.duckdns.org {
    redir https://hospitalmap.duckdns.org{uri} permanent
}

https://hospitalmap.duckdns.org {
    handle /emergency-websocket {
        reverse_proxy http://hospital-backend:8888
    }
    
    handle /api/* {
        reverse_proxy http://hospital-backend:8888
    }
    
    handle /hospitalsData* {
        reverse_proxy http://hospital-backend:8888
    }
    
    handle /pharmaciesData* {
        reverse_proxy http://hospital-backend:8888
    }
    
    respond / \"ğŸ¥ Hospital Service is running!\" 200
    
    header {
        Access-Control-Allow-Origin https://hospitalmap.duckdns.org
        Access-Control-Allow-Methods \"GET, POST, PUT, DELETE, OPTIONS\"
        Access-Control-Allow-Headers \"Accept, Authorization, Content-Type, X-CSRF-Token\"
        Content-Type \"text/plain; charset=utf-8\"
    }
}
" > /etc/caddy/Caddyfile

echo "âœ… Caddyfile ìƒì„± ì™„ë£Œ"
echo "ğŸš€ Caddy ì‹œì‘ ì¤‘..."

caddy run --config /etc/caddy/Caddyfile --adapter caddyfile'
