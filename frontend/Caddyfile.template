# 현재 문제 있는 프론트엔드 정리
docker stop hospital-frontend
docker rm hospital-frontend

# 검증 단계를 건너뛰고 직접 Caddy 실행
docker run -d \
  --name hospital-frontend \
  --network ec2-user_hospital-network \
  -p 80:80 -p 443:443 \
  caddy:2-alpine \
  sh -c '
echo "
{
    email mmmg0306@g.shingu.ac.kr
}

http://hospitalmap.duckdns.org {
    redir https://hospitalmap.duckdns.org{uri} permanent
}

https://hospitalmap.duckdns.org {
    handle /emergency-websocket {
        reverse_proxy http://hospital-backend:8888
    }
    
    handle /api/* {
        reverse_proxy http://hospital-backend:8888
    }
    
    handle /hospitalsData* {
        reverse_proxy http://hospital-backend:8888
    }
    
    handle /pharmaciesData* {
        reverse_proxy http://hospital-backend:8888
    }
    
    respond / \"🏥 Hospital Service is running!\" 200
    
    header {
        Access-Control-Allow-Origin https://hospitalmap.duckdns.org
        Access-Control-Allow-Methods \"GET, POST, PUT, DELETE, OPTIONS\"
        Access-Control-Allow-Headers \"Accept, Authorization, Content-Type, X-CSRF-Token\"
        Content-Type \"text/plain; charset=utf-8\"
    }
}
" > /etc/caddy/Caddyfile

echo "✅ Caddyfile 생성 완료"
echo "🚀 Caddy 시작 중..."

caddy run --config /etc/caddy/Caddyfile --adapter caddyfile'
